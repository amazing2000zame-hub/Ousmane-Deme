# Plan 15-01: Voice Pipeline MCP Tools & Audio Extraction

**Phase:** 15 — Voice Retraining Pipeline
**Requirements:** VOICE-13, VOICE-14, VOICE-15, VOICE-16
**Estimated lines:** ~350

## Goal

Build 4 MCP tools that enable JARVIS to orchestrate the full voice retraining pipeline through chat, plus standalone Python scripts for audio processing. Download JARVIS source material from YouTube compilations and extract clean audio segments.

## Implementation

### 1. New file: `src/mcp/tools/voice.ts` (~300 lines)

Four tools with full pipeline coverage:

| Tool | Tier | Function |
|------|------|----------|
| `extract_voice_audio` | YELLOW | ffmpeg extraction + silencedetect segmentation |
| `prepare_voice_dataset` | YELLOW | faster-whisper transcription + LJSpeech metadata |
| `retrain_voice_model` | YELLOW | Docker exec fine-tuning + weight extraction + embedding |
| `deploy_voice_model` | RED | Container restart + cache clear + health check + test |

Each tool:
- Validates prerequisites (source exists, dataset exists, container running)
- Returns structured text results with progress info
- Has appropriate timeouts (5min extract, 10min transcribe, 60min train, 2min deploy)

### 2. 3-Place Registration

- `src/safety/tiers.ts`: extract/prepare/retrain = YELLOW, deploy = RED
- `src/ai/tools.ts`: 4 Claude descriptions (tool count 28 → 32)
- `src/mcp/server.ts`: import + registerVoiceTools()

### 3. Source material acquisition

- Download "MCU: All J.A.R.V.I.S. Lines" (~8 min) via yt-dlp
- Download "jarvis all scenes" (~7.5 min) via yt-dlp
- Copy existing `/root/jarvis-v3/data/voice-training/jarvis_iron_man_voice.mp4`
- All placed in `/opt/jarvis-tts/sources/`

### 4. Processing scripts (standalone, on Home node)

- `/opt/jarvis-tts/process-sources.py` — ffmpeg silencedetect-based pipeline
- `/opt/jarvis-tts/segment-whisper.py` — faster-whisper VAD-based segmentation (better for audio with background music)

## Verification

- [x] TypeScript compiles clean
- [x] All 64 existing tests pass
- [x] Sources downloaded (~16 min of JARVIS audio)
- [x] Audio segments extracted and transcribed
