---
phase: 02-real-time-dashboard-edex-ui-visual-identity
plan: 04
type: execute
wave: 2
depends_on: ["02-01", "02-02"]
files_modified:
  - jarvis-ui/src/components/left/VMList.tsx
  - jarvis-ui/src/components/left/VMCard.tsx
  - jarvis-ui/src/components/left/StoragePanel.tsx
  - jarvis-ui/src/components/center/CenterDisplay.tsx
  - jarvis-ui/src/components/center/ActivityFeed.tsx
  - jarvis-ui/src/components/shared/ConfirmDialog.tsx
  - jarvis-ui/src/components/shared/GlowBorder.tsx
autonomous: true

must_haves:
  truths:
    - "All 7 VMs/CTs appear in a list with status indicators and start/stop/restart controls"
    - "Start button executes immediately (green tier), stop/restart show confirmation dialog"
    - "Storage overview shows usage bars for all storage pools with threshold coloring"
    - "Center display shows an activity feed with recent events scrolling in real-time"
    - "Confirmation dialog warns about destructive operations before execution"
  artifacts:
    - path: "jarvis-ui/src/components/left/VMList.tsx"
      provides: "VM/Container list with status and action controls"
      min_lines: 30
    - path: "jarvis-ui/src/components/left/VMCard.tsx"
      provides: "Individual VM/CT card with start/stop/restart buttons"
      min_lines: 60
    - path: "jarvis-ui/src/components/left/StoragePanel.tsx"
      provides: "Storage overview with usage bars"
      min_lines: 30
    - path: "jarvis-ui/src/components/center/CenterDisplay.tsx"
      provides: "Context-aware center column switcher"
      min_lines: 20
    - path: "jarvis-ui/src/components/center/ActivityFeed.tsx"
      provides: "Real-time event feed"
      min_lines: 40
    - path: "jarvis-ui/src/components/shared/ConfirmDialog.tsx"
      provides: "Modal confirmation for destructive actions"
      min_lines: 40
    - path: "jarvis-ui/src/components/shared/GlowBorder.tsx"
      provides: "Reusable animated glow border wrapper"
      min_lines: 20
  key_links:
    - from: "jarvis-ui/src/components/left/VMCard.tsx"
      to: "jarvis-ui/src/services/api.ts"
      via: "executeToolApi call for start/stop/restart"
      pattern: "executeToolApi"
    - from: "jarvis-ui/src/components/left/VMList.tsx"
      to: "jarvis-ui/src/stores/cluster.ts"
      via: "useClusterStore vms subscription"
      pattern: "useClusterStore.*vms"
    - from: "jarvis-ui/src/components/center/ActivityFeed.tsx"
      to: "jarvis-ui/src/stores/cluster.ts"
      via: "useClusterStore events subscription"
      pattern: "useClusterStore.*events"
---

<objective>
Build the VM/Container control list with start/stop/restart actions, the storage overview panel, and the center column activity feed. Wire VM lifecycle actions to the backend tool execution endpoint.

Purpose: This plan delivers the interactive controls (start/stop VMs) and the storage overview that complete the left column. The center display provides the "Jarvis main screen" showing what's happening in real-time. Together with Plan 02-03, this completes the data display portion of the dashboard.

Output: Working VM/CT list with action buttons, storage usage overview, activity feed, and confirmation dialog for destructive operations.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-real-time-dashboard-edex-ui-visual-identity/02-CONTEXT.md
@.planning/phases/02-real-time-dashboard-edex-ui-visual-identity/02-RESEARCH.md
@.planning/phases/02-real-time-dashboard-edex-ui-visual-identity/02-01-SUMMARY.md (read after 02-01 completes)

Use types from: jarvis-ui/src/types/cluster.ts, jarvis-ui/src/types/events.ts
Use stores from: jarvis-ui/src/stores/cluster.ts, jarvis-ui/src/stores/auth.ts
Use services from: jarvis-ui/src/services/api.ts
Use shared components from: jarvis-ui/src/components/shared/ (StatusDot, UsageBar, StalenessWarning from Plan 02-03)
Use layout from: jarvis-ui/src/components/layout/PanelFrame.tsx (from Plan 02-03)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build VMList, VMCard with lifecycle controls, and ConfirmDialog</name>
  <files>
    jarvis-ui/src/components/left/VMList.tsx
    jarvis-ui/src/components/left/VMCard.tsx
    jarvis-ui/src/components/shared/ConfirmDialog.tsx
  </files>
  <action>
  **components/shared/ConfirmDialog.tsx:**
  - Props: isOpen (boolean), title (string), message (string), confirmLabel? (string, default "Confirm"), cancelLabel? (string, default "Cancel"), variant ('warning' | 'danger'), onConfirm (() => void), onCancel (() => void)
  - Modal overlay: fixed inset-0 bg-black/60 backdrop-blur-sm z-40, centered content
  - Dialog box: bg-jarvis-bg-panel border border-jarvis-amber/30 rounded-lg p-6 max-w-md
  - Title: font-display text-jarvis-amber text-lg uppercase
  - Message: text-jarvis-text text-sm
  - Buttons: Cancel (border button, jarvis-text-dim) and Confirm (solid button -- orange for warning, red for danger)
  - Confirm button has a subtle glow effect on hover
  - Close on Escape key (useEffect keydown listener)
  - Click on overlay background also cancels

  **components/left/VMCard.tsx:**
  - Props: vm (VMData)
  - Displays:
    - Left: StatusDot (running=green, stopped=red, paused=orange) + VM name + type badge ('VM' or 'CT' in small text)
    - Right: VMID in text-xs jarvis-text-dim
    - Below name: node name where VM runs (text-xs jarvis-text-dim)
    - Action buttons (only when vm.status is relevant):
      - If stopped: Show "START" button (green accent). On click: immediately call executeToolApi with tool=`start_vm` or `start_container` (based on vm.type), args={ node: vm.node, vmid: vm.vmid }. Show toast on success/failure via sonner.
      - If running: Show "STOP" and "RESTART" buttons (red/orange accents). These are destructive -- on click, open ConfirmDialog first. Only call executeToolApi after confirmation. Stop uses `stop_vm`/`stop_container`, restart uses `restart_vm`/`restart_container`. Pass `confirmed: true` in the args.
      - If paused: Show "START" button
  - Inline status feedback: After action, briefly flash the card border green (success) or red (failure) using a local state + setTimeout
  - Use toast (sonner) for action results: `toast.success('VM 100 started')` or `toast.error('Failed to stop VM 101: reason')`
  - Background: bg-jarvis-bg-card border border-jarvis-amber/10
  - Hover: bg-jarvis-bg-hover
  - Get token from useAuthStore for API calls

  **components/left/VMList.tsx:**
  - Reads `vms` from useClusterStore
  - Wrapped in PanelFrame with title "VMS & CONTAINERS"
  - Includes StalenessWarning with dataKey="vms" maxAgeMs={30000}
  - Renders a vertical stack of VMCard components
  - Sort: running VMs first, then stopped, then by VMID ascending
  - If vms array is empty: show "Awaiting VM data..." in jarvis-text-dim
  - Show count in panel title: "VMS & CONTAINERS ({count})"
  </action>
  <verify>
  Run `cd /root/jarvis-ui && npx tsc --noEmit` -- must pass with zero type errors.
  VMCard must import and use executeToolApi from services/api.ts.
  VMCard must show ConfirmDialog for stop/restart operations.
  VMCard must call toast from sonner for action feedback.
  </verify>
  <done>
  VM/Container list shows all VMs/CTs with status indicators. Start executes immediately. Stop and restart show confirmation dialog before executing. Actions invoke backend MCP tools via REST API. Toast notifications provide feedback. Cards flash on action result.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build StoragePanel, CenterDisplay, ActivityFeed, and GlowBorder</name>
  <files>
    jarvis-ui/src/components/left/StoragePanel.tsx
    jarvis-ui/src/components/center/CenterDisplay.tsx
    jarvis-ui/src/components/center/ActivityFeed.tsx
    jarvis-ui/src/components/shared/GlowBorder.tsx
  </files>
  <action>
  **components/left/StoragePanel.tsx:**
  - Reads `storage` from useClusterStore
  - Wrapped in PanelFrame with title "STORAGE"
  - Includes StalenessWarning with dataKey="storage" maxAgeMs={60000}
  - For each storage pool, render:
    - Storage name and type badge
    - Node name in text-xs (which node the storage belongs to)
    - UsageBar with value=used/total, label=storage name
    - Capacity text: "used / total" formatted as GB/TB (e.g., "58.2 / 112.0 GB")
    - Status indicator: StatusDot (active=green, inactive=red)
  - If storage array is empty: show "Awaiting storage data..."
  - Compact layout -- each storage row is a slim horizontal bar, not a full card

  **components/shared/GlowBorder.tsx:**
  - Props: children, color? ('amber' | 'cyan' | 'green' | 'red'), intensity? ('low' | 'medium' | 'high'), active? (boolean, default true), className?
  - Wrapper div that adds an animated glow border effect using box-shadow
  - Default: amber color, low intensity
  - CSS: border with matching color, box-shadow with the color's glow value
  - High intensity adds a pulse animation to the glow
  - Only renders the glow effect if active=true AND the current visual mode has glowEffects enabled (read from useUIStore -> check VISUAL_MODES[mode].glowEffects)
  - When active=false or glowEffects disabled, renders children without any glow (just a plain wrapper div)

  **GlowBorder integration points (for use in this plan and later plans):**
  - In VMCard: Wrap the card content with `<GlowBorder color="green" intensity="medium" active={actionSuccess}>` to flash green on successful VM action. The `active` prop is tied to the actionSuccess local state that flashes briefly after a tool execution succeeds.
  - In ActivityFeed: Wrap critical/error events with `<GlowBorder color="red" intensity="low">` to draw attention to important events.
  - Future integration (Plan 02-05): TerminalPanel will use `<GlowBorder color="cyan" active={isConnected}>` to glow when the terminal has an active SSH connection.
  - Future integration (Plan 02-06): PanelFrame will optionally accept a glow prop for focused panel highlighting.

  **components/center/CenterDisplay.tsx:**
  - The center column's main component -- context-aware view switcher
  - For now, it displays the ActivityFeed as the default view
  - In Phase 3 this will switch between ActivityFeed, JarvisDisplay, and Chat
  - Simple wrapper: renders ActivityFeed inside a PanelFrame with title "JARVIS ACTIVITY"
  - Takes full height of center column

  **components/center/ActivityFeed.tsx:**
  - Reads `events` from useClusterStore (the bounded array from Plan 02-01's store, max 100 items)
  - Renders events as a scrolling list, newest at top
  - Each event shows:
    - Timestamp formatted as HH:MM:SS
    - Severity icon/color: info=cyan, warning=orange, error=red, critical=red+bold
    - Title text
    - Message text in smaller font
    - Node name if present
  - Critical and error severity events are wrapped in `<GlowBorder color="red" intensity="low">` to visually highlight them
  - Auto-scrolls to top when new events arrive
  - If no events: show "No activity yet. Monitoring cluster..." in jarvis-text-dim with a subtle pulse animation
  - Wrap in a container with overflow-y-auto and max-height to allow scrolling
  - The feed should feel like eDEX-UI data scrolling -- monospace font for timestamps, tight line height

  **Wire into Dashboard.tsx:**
  After creating these components, update Dashboard.tsx (from Plan 02-03):
  - Left column: ADD VMList + StoragePanel below the existing NodeGrid (stacked vertically with overflow-y-auto). Do NOT remove or modify NodeGrid.
  - Center column: REPLACE the placeholder text with CenterDisplay component
  - Right column: Do NOT modify -- leave the existing placeholder for Plan 02-05
  </action>
  <verify>
  Run `cd /root/jarvis-ui && npm run build` -- must succeed.
  StoragePanel must read from useClusterStore.storage.
  ActivityFeed must read from useClusterStore.events.
  ActivityFeed must use GlowBorder for critical/error events.
  VMCard must use GlowBorder for action success feedback.
  Dashboard.tsx must render NodeGrid, VMList, StoragePanel in left column and CenterDisplay in center.
  Dashboard.tsx right column must still be a placeholder (not modified by this plan).
  </verify>
  <done>
  Left column is complete with NodeGrid, VMList, and StoragePanel stacked vertically. Center column shows ActivityFeed with real-time events. Storage usage is visualized with bars and threshold coloring. GlowBorder is integrated into VMCard (action success flash) and ActivityFeed (critical event highlighting). The dashboard now shows all cluster infrastructure data with interactive controls.
  </done>
</task>

</tasks>

<verification>
1. `cd /root/jarvis-ui && npm run build` succeeds
2. VMList renders VM/CT cards with status indicators
3. Start button works without confirmation
4. Stop/restart show ConfirmDialog before execution
5. VMCard calls executeToolApi with correct tool names
6. VMCard uses GlowBorder to flash green on successful action
7. StoragePanel shows usage bars for all storage pools
8. ActivityFeed renders events from store
9. ActivityFeed uses GlowBorder to highlight critical/error events
10. CenterDisplay wraps ActivityFeed in PanelFrame
11. Dashboard.tsx renders all left column panels and center display
12. GlowBorder respects visual mode settings
</verification>

<success_criteria>
The left column is fully populated with node health (from Plan 02-03), VM/CT controls, and storage overview. The center column shows a real-time activity feed. Users can start VMs with one click and stop/restart with confirmation. GlowBorder provides visual emphasis on VMCard action results and critical events. All data flows from the backend through Socket.IO to Zustand to rendered components.
</success_criteria>

<output>
After completion, create `.planning/phases/02-real-time-dashboard-edex-ui-visual-identity/02-04-SUMMARY.md`
</output>
