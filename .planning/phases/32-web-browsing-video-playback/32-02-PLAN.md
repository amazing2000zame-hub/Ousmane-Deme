---
phase: 32-web-browsing-video-playback
plan: 02
type: execute
wave: 2
depends_on: [32-01]
files_modified:
  - jarvis-ui/src/stores/chat.ts
  - jarvis-ui/src/components/center/SearchResultsCard.tsx
  - jarvis-ui/src/hooks/useChatSocket.ts
  - jarvis-ui/src/components/center/ChatMessage.tsx
  - jarvis-backend/src/mcp/tools/web.ts
autonomous: true

must_haves:
  truths:
    - "Search results display inline in the chat as a clickable card"
    - "Each result shows title, URL, and snippet"
    - "Clicking a result opens the URL in a new tab"
    - "Socket event chat:show_search_results triggers the UI update"
  artifacts:
    - path: "jarvis-ui/src/components/center/SearchResultsCard.tsx"
      provides: "Search results display component"
      contains: "SearchResultsCard"
    - path: "jarvis-ui/src/stores/chat.ts"
      provides: "searchResults state in chat store"
      contains: "searchResults"
    - path: "jarvis-ui/src/hooks/useChatSocket.ts"
      provides: "Socket handler for search results"
      contains: "chat:show_search_results"
---

<objective>
Create the SearchResultsCard UI component and wire up socket events so web search results display inline in the chat. This is Wave 2 of Phase 32.

Purpose: Display search results in a visually appealing, interactive format that matches the eDEX-UI aesthetic.

Output: When web_search tool returns results, they appear as a styled card in the chat with clickable links.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/32-web-browsing-video-playback/32-RESEARCH.md

Source files to modify:
@jarvis-ui/src/stores/chat.ts
@jarvis-ui/src/hooks/useChatSocket.ts
@jarvis-ui/src/components/center/ChatMessage.tsx
@jarvis-backend/src/mcp/tools/web.ts

Reference files:
@jarvis-ui/src/components/center/InlineCameraCard.tsx (pattern for inline cards)
@jarvis-ui/src/components/center/ToolStatusCard.tsx (pattern for tool result display)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add searchResults to chat store</name>
  <files>jarvis-ui/src/stores/chat.ts</files>
  <action>
  Add search results state to the chat store.

  Add interface for search result:
  ```typescript
  interface SearchResult {
    title: string;
    url: string;
    snippet: string;
    engine?: string;
  }

  interface SearchResults {
    query: string;
    results: SearchResult[];
    timestamp: string;
  }
  ```

  Add to ChatMessage interface:
  ```typescript
  searchResults?: SearchResults;
  ```

  Add action to set search results on a message:
  ```typescript
  setSearchResults: (results: SearchResults) => void;
  ```

  Implement the action (similar to setInlineCamera):
  ```typescript
  setSearchResults: (results) => {
    set((state) => {
      const messages = [...state.messages];
      // Find last assistant message
      for (let i = messages.length - 1; i >= 0; i--) {
        if (messages[i].role === 'assistant') {
          messages[i] = { ...messages[i], searchResults: results };
          break;
        }
      }
      return { messages };
    });
  },
  ```
  </action>
  <verify>
  ```bash
  cd /root/jarvis-ui && npx tsc --noEmit 2>&1 | head -20
  ```
  </verify>
  <done>
  - SearchResult and SearchResults interfaces defined
  - searchResults optional property on ChatMessage
  - setSearchResults action implemented
  </done>
</task>

<task type="auto">
  <name>Task 2: Create SearchResultsCard component</name>
  <files>jarvis-ui/src/components/center/SearchResultsCard.tsx</files>
  <action>
  Create the search results display component with eDEX-UI styling.

  ```typescript
  import React from 'react';
  import './SearchResultsCard.css';

  interface SearchResult {
    title: string;
    url: string;
    snippet: string;
    engine?: string;
  }

  interface SearchResultsCardProps {
    query: string;
    results: SearchResult[];
    timestamp: string;
  }

  export const SearchResultsCard: React.FC<SearchResultsCardProps> = React.memo(
    ({ query, results, timestamp }) => {
      const handleResultClick = (url: string) => {
        window.open(url, '_blank', 'noopener,noreferrer');
      };

      return (
        <div className="search-results-card">
          <div className="search-results-header">
            <span className="search-icon">üîç</span>
            <span className="search-query">"{query}"</span>
            <span className="search-count">{results.length} results</span>
          </div>
          <div className="search-results-list">
            {results.map((result, index) => (
              <div
                key={index}
                className="search-result-item"
                onClick={() => handleResultClick(result.url)}
                role="button"
                tabIndex={0}
                onKeyDown={(e) => e.key === 'Enter' && handleResultClick(result.url)}
              >
                <div className="result-title">{result.title}</div>
                <div className="result-url">{result.url}</div>
                {result.snippet && (
                  <div className="result-snippet">{result.snippet}</div>
                )}
                {result.engine && (
                  <div className="result-engine">via {result.engine}</div>
                )}
              </div>
            ))}
          </div>
          <div className="search-results-footer">
            <span className="search-timestamp">
              {new Date(timestamp).toLocaleTimeString()}
            </span>
          </div>
        </div>
      );
    }
  );

  SearchResultsCard.displayName = 'SearchResultsCard';
  ```

  Create the CSS file `SearchResultsCard.css`:
  ```css
  .search-results-card {
    background: rgba(0, 0, 0, 0.6);
    border: 1px solid var(--hud-color, #0af);
    border-radius: 8px;
    padding: 12px;
    margin: 8px 0;
    max-width: 600px;
  }

  .search-results-header {
    display: flex;
    align-items: center;
    gap: 8px;
    padding-bottom: 8px;
    border-bottom: 1px solid rgba(0, 170, 255, 0.3);
    margin-bottom: 8px;
  }

  .search-icon {
    font-size: 16px;
  }

  .search-query {
    color: var(--hud-color, #0af);
    font-weight: 500;
    flex: 1;
  }

  .search-count {
    color: rgba(255, 255, 255, 0.5);
    font-size: 12px;
  }

  .search-results-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
    max-height: 400px;
    overflow-y: auto;
  }

  .search-result-item {
    padding: 10px;
    background: rgba(0, 170, 255, 0.05);
    border: 1px solid rgba(0, 170, 255, 0.2);
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .search-result-item:hover {
    background: rgba(0, 170, 255, 0.15);
    border-color: var(--hud-color, #0af);
  }

  .result-title {
    color: var(--hud-color, #0af);
    font-weight: 500;
    margin-bottom: 4px;
  }

  .result-url {
    color: rgba(0, 255, 136, 0.8);
    font-size: 11px;
    margin-bottom: 4px;
    word-break: break-all;
  }

  .result-snippet {
    color: rgba(255, 255, 255, 0.7);
    font-size: 12px;
    line-height: 1.4;
  }

  .result-engine {
    color: rgba(255, 255, 255, 0.4);
    font-size: 10px;
    margin-top: 4px;
  }

  .search-results-footer {
    padding-top: 8px;
    border-top: 1px solid rgba(0, 170, 255, 0.3);
    margin-top: 8px;
  }

  .search-timestamp {
    color: rgba(255, 255, 255, 0.4);
    font-size: 10px;
  }
  ```
  </action>
  <verify>
  ```bash
  ls -la /root/jarvis-ui/src/components/center/SearchResultsCard.* && cd /root/jarvis-ui && npx tsc --noEmit 2>&1 | head -10
  ```
  </verify>
  <done>
  - SearchResultsCard.tsx created with React.memo
  - SearchResultsCard.css created with eDEX-UI styling
  - Click handler opens URLs in new tab
  - Keyboard accessible (Enter key support)
  </done>
</task>

<task type="auto">
  <name>Task 3: Add socket handler for search results</name>
  <files>jarvis-ui/src/hooks/useChatSocket.ts</files>
  <action>
  Add socket event handler for chat:show_search_results.

  Add handler function:
  ```typescript
  function onShowSearchResults(data: { query: string; results: Array<{ title: string; url: string; snippet: string; engine?: string }>; timestamp: string }) {
    useChatStore.getState().setSearchResults(data);
  }
  ```

  Add socket listener in useEffect:
  ```typescript
  socket.on('chat:show_search_results', onShowSearchResults);
  ```

  Add cleanup:
  ```typescript
  socket.off('chat:show_search_results', onShowSearchResults);
  ```
  </action>
  <verify>
  ```bash
  grep -n "show_search_results\|onShowSearchResults" /root/jarvis-ui/src/hooks/useChatSocket.ts
  ```
  </verify>
  <done>
  - onShowSearchResults handler implemented
  - Socket listener registered for chat:show_search_results
  - Cleanup added
  </done>
</task>

<task type="auto">
  <name>Task 4: Render SearchResultsCard in ChatMessage</name>
  <files>jarvis-ui/src/components/center/ChatMessage.tsx</files>
  <action>
  Import and render SearchResultsCard when message has searchResults.

  Add import:
  ```typescript
  import { SearchResultsCard } from './SearchResultsCard';
  ```

  Add rendering after tool calls (similar to InlineCameraCard):
  ```typescript
  {message.searchResults && (
    <SearchResultsCard
      query={message.searchResults.query}
      results={message.searchResults.results}
      timestamp={message.searchResults.timestamp}
    />
  )}
  ```
  </action>
  <verify>
  ```bash
  grep -n "SearchResultsCard\|searchResults" /root/jarvis-ui/src/components/center/ChatMessage.tsx
  ```
  </verify>
  <done>
  - SearchResultsCard imported
  - Rendered when message.searchResults exists
  </done>
</task>

<task type="auto">
  <name>Task 5: Emit socket event from web_search tool</name>
  <files>jarvis-backend/src/mcp/tools/web.ts</files>
  <action>
  Update web_search to emit socket event with search results for UI display.

  Add import at top:
  ```typescript
  import { chatNs } from '../../index.js';
  ```

  After successful search, emit the event before returning:
  ```typescript
  // Emit to UI for inline display
  if (chatNs) {
    chatNs.emit('chat:show_search_results', {
      query,
      results,
      timestamp: new Date().toISOString(),
    });
  }
  ```
  </action>
  <verify>
  ```bash
  grep -n "chat:show_search_results\|chatNs" /root/jarvis-backend/src/mcp/tools/web.ts
  ```
  </verify>
  <done>
  - chatNs imported from index.js
  - Socket event emitted with query, results, timestamp
  </done>
</task>

</tasks>

<verification>
1. **Build and deploy:**
   ```bash
   cd /root && docker compose up -d --build
   ```

2. **Wait for containers:**
   ```bash
   sleep 30 && docker compose ps
   ```

3. **Test search via UI:**
   Open http://192.168.1.50:3004 and ask "search for weather in New York"

4. **Verify results display inline with:**
   - Query shown in header
   - Clickable result items
   - URL opens in new tab on click
</verification>

<success_criteria>
1. SearchResultsCard component exists and renders
2. Socket event handler registered
3. Search results display inline in chat
4. Results are clickable and open in new tab
5. Styling matches eDEX-UI theme
6. TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/32-web-browsing-video-playback/32-02-SUMMARY.md`
</output>
