# Plan 13-02: Project Browsing MCP Tools

**Phase:** 13 -- Project Intelligence
**Goal:** 4 GREEN tier MCP tools for browsing, reading, and searching project files

## Tools

### 1. list_projects (GREEN)
- Lists all projects from the cached registry
- Optional text filter for name/description/type search
- Flat sorted list with full cards (name, node, type, path, description, version, lastModified)
- For 24 projects, shows all at once (no pagination needed at this scale)

### 2. get_project_structure (GREEN)
- Resolves project by name from registry
- Shows directory tree with configurable maxDepth (default 3)
- Local (Home) uses recursive `fs.readdir`, remote uses `find` via SSH
- Filters noise (.DS_Store), skip dirs (node_modules, .git, dist), and secret files
- Indented tree-view output

### 3. read_project_file (GREEN)
- Resolves project, constructs full path from relative file path
- Secret blocking check via `isSecretFile()` before any read
- Path sanitization via `sanitizePath(fullPath, projectPath)` to prevent traversal
- 1 MB file size limit
- Local reads via `fs.readFile`, remote via SSH `cat`
- Returns file content with header showing project/file/node

### 4. search_project_files (GREEN)
- Resolves project, runs `grep -rn` across project directory
- Excludes node_modules, .git, dist, __pycache__, .venv
- Post-filters results through `isSecretFileSync()` to strip matches from secret files
- Max 100 results returned
- Optional `fileFilter` parameter for extension filtering (e.g., "ts", "py")
- Returns relative paths with line numbers and matching content

## Files

- `src/mcp/tools/projects.ts` (new -- 4 tools)

## Design Decisions

- Flat sorted list per user preference (not grouped by node)
- Full card per project per user preference
- All 4 tools are GREEN tier (read-only, no side effects)
- Node name mapping: registry uses lowercase ("home"), config uses mixed case ("Home")
- Local execution for Home node (direct fs), SSH for remote nodes

## Dependencies

- Registry client (`src/clients/registry.ts`)
- Secret blocking (`src/safety/secrets.ts`)
- Path sanitization (`src/safety/paths.ts`)
- SSH client (`src/clients/ssh.ts`)
