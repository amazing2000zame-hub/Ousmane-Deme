# Plan 13-03: Secret Blocking Infrastructure

**Phase:** 13 -- Project Intelligence
**Goal:** Block reads of sensitive files through project browsing tools

## Blocking Rules

### Blocked Filenames (exact, case-insensitive)
`.env`, `.env.local`, `.env.production`, `.env.development`, `.env.staging`, `.env.test`,
`.env.example`, `.npmrc`, `.pypirc`, `.netrc`, `.pgpass`, `.my.cnf`, `.s3cfg`,
`credentials`, `credentials.json`, `service-account.json`, `service_account.json`,
`keyfile.json`, `secrets.json`, `secrets.yaml`, `secrets.yml`, `vault.json`,
`vault.yaml`, `vault.yml`, `.htpasswd`, `shadow`, `master.key`, `token.json`

### Blocked Filename Patterns (startsWith/endsWith)
- startsWith: `.env.`
- endsWith: `_rsa`, `_rsa.pub`, `_ed25519`, `_ed25519.pub`, `_ecdsa`, `_dsa`, `.pem`, `.key`, `.p12`, `.pfx`, `.jks`, `.keystore`

### Blocked Path Segments (any directory in path)
`.git`, `.ssh`, `.gnupg`, `.docker`, `.kube`, `.aws`, `.azure`, `.gcloud`

## API

- `isSecretFile(filePath, tool)` -- async, with audit logging
- `isSecretFileSync(filePath)` -- sync, for filtering in loops (no logging)

## Safety Audit

- All blocked attempts logged via `logSafetyAudit('secret_file_blocked', ...)` to the events table
- New audit action type added to `SafetyAuditAction` union in `paths.ts`

## Files

- `src/safety/secrets.ts` (new)
- `src/safety/paths.ts` (modified -- added `secret_file_blocked` to SafetyAuditAction)

## Dependencies

- `src/safety/paths.ts` (logSafetyAudit function)
- No new npm dependencies
