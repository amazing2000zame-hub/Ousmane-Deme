# Plan 10-02: Integration Tests + API Tests

## Goal
Write integration tests for REST API endpoints and Socket.IO chat flow with mocked providers.

## Requirements Addressed
TEST-05 (E2E against deployed containers), TEST-06 (API tests), TEST-07 (WebSocket tests), TEST-08 (auth tests), TEST-09 (cost API), TEST-10 (memory API), TEST-11 (health check), TEST-12 (graceful shutdown)

## Files to Create

### 1. `jarvis-backend/src/__tests__/api-cost.test.ts`
Cost API integration tests:
- GET /api/cost/summary (daily, weekly, monthly)
- GET /api/cost/budget
- GET /api/cost/sessions
- GET /api/cost/history
- Auth required (401 without token)

### 2. `jarvis-backend/src/__tests__/api-memory.test.ts`
Memory API integration tests:
- GET /api/memory/search?q=test
- GET /api/memory/stats
- GET /api/memory/recent
- GET /api/memory/preferences
- POST /api/memory (create)
- DELETE /api/memory/:id
- DELETE /api/memory/tier/:tier
- Auth required

### 3. `jarvis-backend/src/__tests__/api-auth.test.ts`
Auth integration tests:
- POST /api/auth/login (valid password → token)
- POST /api/auth/login (invalid password → 401)
- Protected routes reject missing/invalid tokens
- Health endpoint accessible without auth

### 4. `jarvis-backend/src/__tests__/helpers/setup.ts`
Test setup helpers:
- In-memory SQLite database for tests
- Mock auth token generator
- Test Express app factory (creates app without starting server)

## Verification
- [ ] All API endpoints tested with assertions
- [ ] Auth flows verified (login, token validation, rejection)
- [ ] Memory CRUD operations verified via API
- [ ] Cost calculations verified via API
- [ ] Tests use in-memory SQLite (no file I/O)
