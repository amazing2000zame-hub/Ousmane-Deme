# Milestone v1.6: Smart Home Intelligence

**Status:** IN PROGRESS
**Phases:** 26-29
**Target:** Give JARVIS eyes -- camera face recognition, presence tracking, and proactive alerts

## Overview

Jarvis v1.6 integrates Frigate's native face recognition with presence tracking and proactive intelligence. Users can ask "Who's at the door?" and get face-identified answers, track arrival/departure patterns, view camera feeds in the dashboard, and receive proactive alerts for unknown persons. The build leverages existing Frigate 0.16.4 infrastructure (face recognition available but disabled) and extends the current MCP tool set.

## Phases

### Phase 26: Face Recognition Foundation

**Goal:** Users can ask "Who's at the door?" and receive face-identified responses using Frigate's built-in recognition.

**Depends on:** Nothing (first phase) -- extends existing Frigate integration

**Plans:** 2 plans

- [ ] 26-01: Enable Frigate face recognition, update frigate.ts client for sub_label and face library APIs
- [ ] 26-02: New MCP tools (whos_at_door, get_recognized_faces, get_unknown_visitors) with GREEN tier

**Requirements addressed:** FACE-01 through FACE-05

**Success Criteria:**
1. User asks "Who's at the door?" and JARVIS returns the recognized face name (or "unknown person")
2. User can query recent visitors by face name via natural language
3. Frigate Face Library UI at `/face-library` is accessible for manual face enrollment
4. Events with `sub_label` data are correctly parsed and returned by MCP tools
5. Unknown persons (person event without sub_label) are identifiable in query results

---

### Phase 27: Presence Intelligence

**Goal:** Users can ask "Who's home?" and get a comprehensive answer combining network presence, camera detection, and face recognition.

**Depends on:** Phase 26 (face recognition data available)

**Plans:** 2 plans

- [x] 27-01: SQLite presence_logs table, presence state tracker, enhanced get_who_is_home tool
- [ ] 27-02: Presence history MCP tool, presence context injection into system prompt

**Requirements addressed:** PRES-01 through PRES-05

**Success Criteria:**
1. User asks "Who's home?" and gets combined signal response (network + camera + face)
2. User can query "When did [person] arrive/leave?" and get historical data
3. Arrival detection: person detected at entry camera with face recognition updates presence state
4. Departure detection: phone leaving network + no recent camera sightings marks away
5. JARVIS knows who is home during conversation (presence in system prompt context)

---

### Phase 28: Camera Dashboard

**Goal:** Users can view camera snapshots, event history, and live feeds in the Jarvis dashboard without leaving the UI.

**Depends on:** Phase 26 (face-annotated events)

**Plans:** 2 plans

- [ ] 28-01: CameraPanel component with snapshot grid, refresh on demand, click-to-enlarge
- [ ] 28-02: EventList component with thumbnails, face labels, filters, and live view integration (MSE/go2rtc)

**Requirements addressed:** CAM-01 through CAM-05

**Success Criteria:**
1. Dashboard shows 2-camera snapshot grid (front_door, side_house) with auto-refresh
2. User can click a camera to see full-size snapshot in modal
3. Recent events panel shows detection thumbnails with face labels (recognized name or "Unknown")
4. User can filter events by camera, object type, or time range
5. Live view button opens MSE stream from go2rtc for selected camera

---

### Phase 29: Proactive Intelligence

**Goal:** JARVIS proactively notifies users of significant events (unknown person at door) via dashboard and optional TTS.

**Depends on:** Phase 26-28 (face recognition, presence state, camera UI)

**Plans:** 2 plans

- [ ] 29-01: Event subscription service (poll Frigate every 5s), unknown person detection, Socket.IO emitter
- [ ] 29-02: Dashboard notification component, TTS announcement integration, cooldown logic

**Requirements addressed:** ALERT-01 through ALERT-05

**Success Criteria:**
1. Unknown person at front_door triggers dashboard notification within 10 seconds
2. Notifications show snapshot thumbnail and camera name
3. 5-minute cooldown prevents repeated alerts for same person lingering
4. Optional TTS announcement: "Sir, there is someone I don't recognize at the front door"
5. User can ask "What happened while I was away?" and get event summary

---

## Phase Dependencies

```
Phase 26: Face Recognition Foundation
    |
    +-------------------------------+
    |                               |
    v                               v
Phase 27: Presence Intelligence   Phase 28: Camera Dashboard
    |                               |
    +-------------------------------+
    |
    v
Phase 29: Proactive Intelligence
```

Phase 27 and 28 can proceed in parallel after Phase 26 completes.

---

## Technical Constraints

| Constraint | Impact | Mitigation |
|------------|--------|------------|
| CPU-only inference | Face recognition must use `model_size: small` | FaceNet adequate for 5-10 faces |
| 2 cameras only | Limited coverage for POC | front_door (entry), side_house (driveway) sufficient |
| No MQTT currently | Higher latency for event detection | HTTP polling at 5s interval; MQTT upgrade deferred to v1.7 |
| Single user system | Skip multi-user permissions | Simplifies presence tracking |
| LAN-only access | No remote viewing | All traffic local, no auth required for Frigate |

---

## File Change Estimates

| Phase | New Files | Modified Files | LOC Estimate |
|-------|-----------|----------------|--------------|
| 26 | 0 | 3 (frigate.ts, smarthome.ts, tiers.ts) | ~200 |
| 27 | 2 (presence.ts, schema extension) | 3 (smarthome.ts, system-prompt.ts, get_who_is_home) | ~350 |
| 28 | 3 (CameraPanel.tsx, EventList.tsx, LiveView.tsx) | 2 (CenterDisplay.tsx, stores) | ~500 |
| 29 | 2 (event-subscription.ts, NotificationToast.tsx) | 3 (server.ts, TTS integration, socket) | ~400 |

**Total estimate:** ~1,450 LOC across 8 plans

---

## Milestone Summary

**Key Decisions:**
- Use Frigate's native face recognition (not custom ML in Jarvis)
- HTTP polling for events (5s interval) -- MQTT upgrade deferred
- SQLite for presence logs (extends existing schema)
- MSE streaming via go2rtc for live view (not HLS)
- Proactive alerts to dashboard only (TTS optional, not default)

**What's Deferred to v1.7+:**
- MQTT subscription for real-time events
- Face enrollment from chat ("JARVIS, learn this face as John")
- Historical presence patterns ("John usually arrives at 6pm")
- Multi-camera live grid (bandwidth optimization)
- Alert preferences UI (over-engineering for single user)
- Presence-based automations (needs automation engine)

---

_For requirements detail, see .planning/REQUIREMENTS-v1.6.md_
_For architecture context, see .planning/research/ARCHITECTURE.md_
